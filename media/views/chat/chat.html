<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Chat</title>
    <link rel="stylesheet" href="chat.css" />
    <style>
      #input-container {
        display: flex;
        padding: 8px;
        background: #ddd;
      }
      textarea {
        flex: 1;
        resize: none;
      }
      button {
        margin-left: 4px;
      }
      .user {
        color: blue;
        margin: 2px 0;
      }
      .assistant {
        color: green;
        margin: 2px 0;
      }
    </style>
  </head>
  <body>
    <div id="libre-chat"></div>
    <div id="input-container">
      <textarea id="input" rows="2" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
      <button id="send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button id="clear">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
    <script>
      const vscode = acquireVsCodeApi();
      const chatDiv = document.getElementById('libre-chat');
      const input = document.getElementById('input');
      const sendBtn = document.getElementById('send');
      const clearBtn = document.getElementById('clear');

      sendBtn.addEventListener('click', () => {
        const text = input.value.trim();
        if (!text) return;
        vscode.postMessage({ type: 'chat', text });
        appendMessage('user', text);
        input.value = '';
      });

      clearBtn.addEventListener('click', () => {
        vscode.postMessage({ type: 'clear' });
        chatDiv.innerHTML = '';
      });

      window.addEventListener('message', (event) => {
        const msg = event.data;
        if (msg.type === 'addMessage') {
          appendMessage(msg.role, msg.text);
        }
      });

      function appendMessage(role, text) {
        const div = document.createElement('div');
        div.className = role;
        div.textContent = (role === 'user' ? 'üë§ ' : 'ü§ñ ') + text;
        chatDiv.appendChild(div);
        chatDiv.scrollTop = chatDiv.scrollHeight;
      }
    </script>
  </body>
</html>
